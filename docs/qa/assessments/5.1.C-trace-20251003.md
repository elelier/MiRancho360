# Requirements Traceability Matrix

## Story: 5.1.C - Input Improvements

### Coverage Summary

- Total Requirements: 6
- Fully Covered: 1 (17%)
- Partially Covered: 3 (50%)
- Not Covered: 2 (33%)

### Requirement Mappings

#### AC-1: Estado de Éxito

**Coverage: FULL**

- Test File: `src/components/common/__tests__/Input.test.tsx`
  - Test Case: `renders success message and icon when provided`
    - Given: Un input con etiqueta "Nombre" y prop `success` definida
    - When: Se renderiza el componente
    - Then: Se muestra el texto de éxito con `role="status"` e icono oculto al lector de pantalla
- Test File: `src/components/common/__tests__/Input.test.tsx`
  - Test Case: `renders success message when provided` (Select)
    - Given: Un Select con opciones y prop `success`
    - When: Se monta el componente
    - Then: Se renderiza el mensaje verde asociado al éxito
- Test File: `src/components/common/__tests__/Input.test.tsx`
  - Test Case: `renders success message when provided` (Textarea)
    - Given: Textarea con prop `success`
    - When: Se renderiza el control
    - Then: Se muestra el mensaje de confirmación

#### AC-2: Estado Disabled Mejorado

**Coverage: PARTIAL**

- Test File: `src/components/common/__tests__/Input.test.tsx`
  - Test Case: `includes disabled utility classes`
    - Given: Input con `disabled`
    - When: Se renderiza
    - Then: El control queda deshabilitado (atributo `disabled` presente)
- Gap: No hay aserciones sobre clases `disabled:bg-gray-100` / `disabled:text-gray-600` ni verificación visual en Select/Textarea
- Suggested Test: 5.1.C-UNIT-003 (añadir snapshot/clase para todos los componentes)

#### AC-3: Focus Mejorado

**Coverage: NONE**

- Gap: No existen pruebas que validen `focus:ring-4` ni comportamiento de focus accesible
- Suggested Test: 5.1.C-E2E-001 (Playwright: navegar con tab sobre Input/Select/Textarea verificando ring y outline)

#### AC-4: Contraste WCAG AA

**Coverage: NONE**

- Gap: No se ejecutaron Lighthouse ni herramientas de contraste automatizadas
- Suggested Test: 5.1.C-E2E-002 (Lighthouse/axe sobre `/demo/input`)

#### AC-5: Accesibilidad (labels, aria, anuncios, teclado)

**Coverage: PARTIAL**

- Test File: `src/components/common/__tests__/Input.test.tsx`
  - Test Case: `renders error state with aria attributes`
    - Given: Input con prop `error`
    - When: Se renderiza
    - Then: `aria-invalid` y `role="alert"` quedan correctamente asignados
  - Test Case: `adds placeholder hint when required without placeholder`
    - Given: Input con `required`
    - When: Se renderiza
    - Then: Placeholder automático comunica "Campo requerido *" y `aria-required`
  - Test Case: `shows required placeholder when necessary` (Select)
    - Given: Select requerido sin valor
    - When: Usuario abre el control
    - Then: Placeholder bloqueado exige selección
- Gap: Sin validación de screen reader real ni navegación por teclado en entorno real
- Suggested Tests: 5.1.C-E2E-001 (teclado) y 5.1.C-E2E-003 (lectores de pantalla)

#### AC-6: Tests (unitarios, accesibilidad, Lighthouse)

**Coverage: PARTIAL**

- Evidence: `npx vitest run src/components/common/__tests__/Input.test.tsx` ejecutado durante desarrollo
- Gap: Falta correr `axe-core` y `npm run lighthouse` como exige CA-6
- Suggested Actions: Ejecutar suites de accesibilidad + Lighthouse y adjuntar resultados

### Critical Gaps

1. **AC-3 Focus Mejorado**
   - Gap: Sin tests automatizados
   - Risk: Medio (puede pasar desapercibido en navegadores con focus ring distinto)
   - Action: Implementar 5.1.C-E2E-001

2. **AC-4 Contraste WCAG AA**
   - Gap: Sin medición de contraste/Lighthouse
   - Risk: Alto (involucra cumplimiento accesibilidad)
   - Action: Correr Lighthouse/axe, documentar puntajes =90

3. **AC-5 Anuncios de accesibilidad**
   - Gap: Sin validación con lector de pantalla real
   - Risk: Medio (usuarios senior dependen del feedback auditivo)
   - Action: Ejecutar 5.1.C-E2E-003 y adjuntar hallazgos

### Test Design Alignment

- Referencia matriz: `docs/qa/assessments/5.1.C-test-design-20251003.md`
- Prioridad de ejecución: Seguir orden recomendado en test design, enfocando primero los P0

### Risk Assessment Linkage

- Riesgos BUS-001 y OPS-001 permanecen abiertos hasta que se completen los tests E2E (Lighthouse, SR)
- Riesgo TECH-001 mitigado parcialmente con 5.1.C-UNIT-002; falta confirmación integraciones

---

Trace matrix: docs/qa/assessments/5.1.C-trace-20251003.md
